#!/bin/bash
set -e

OPTS=""

while [[ $# > 0 ]]
do
  key="$1"

  case $key in
    clang)
    echo "using clang"
    COMPILER="$key"
    OPTS="-DCMAKE_USER_MAKE_RULES_OVERRIDE=$HOMEDIR/clang-overrides.txt"
    ;;
    gnu)
    echo "using gnu"
    COMPILER="$key"
    ;;
    arm)
    echo "targeting arm"
    ARCH="$key"
    ;;
    intel)
    echo "targeting intel"
    ARCH="$key"
    ;;
    *)
    echo "Unknown option, using defaults"
    COMPILER="gnu"
    ARCH="arm"
    ;;
  esac
  shift
done

HOMEDIR=/home/healem/bbb
TARGETDIR=$HOMEDIR/builds/$COMPILER-$ARCH-bbb
LIBDIR=$TARGETDIR/lib

if [ ! -d $LIBDIR ]
then
  mkdir -p $LIBDIR
fi

# build inih
#cd /home/healem/inih
#cmake -DCMAKE_TOOLCHAIN_FILE=$HOMEDIR/$COMPILER-$ARCH-toolchain.cmake $OPTS
#make
#cp lib/*.so $LIBDIR

# build bbb
cd $HOMEDIR
cmake -DCMAKE_TOOLCHAIN_FILE=$HOMEDIR/$COMPILER-$ARCH-toolchain.cmake $OPTS
make

